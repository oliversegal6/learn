---
title: 分布式系统
date: 2019-05-24 22:06:47
categories: 
- 软件开发
- 系统架构
- 分布式架构
---

# 分布式系统

## 数据访问层

单机数据库性能不足的情况下，需要进行拆分。

### 数据库垂直和水平拆分

不升级硬件的情况下，要通过数据库减压的方式来优化。
1. 优化应用，减少不必要的数据库访问。
2. 引入其他方式来降低压力，引入缓存加搜索引擎。
3. 建立数据库集群，拆分数据

数据拆分有两种，垂直拆分和水平拆分。垂直拆分是把不同的业务数据分到不同的数据库，水平拆分是根据一定规则把同一业务数据拆分到多个数据库。

垂直拆分会有以下影响：
- 单机ACID被打破，要么放弃修改逻辑，要么使用分布式事物
- 一些Join操作变得困难
- 外键约束会受影响

水平拆分会有以下影响：
- 单机ACID被打破，要么放弃修改逻辑，要么使用分布式事物
- 一些Join操作变得困难
- 外键约束会受影响
- 依赖单库的自增ID会受到影响
- 业务上的单表查询要跨库了，可能需要多次查询

### 分布式环境下的一致性（事务）

- 2PC: Two Phase Commitment Protocol
- Paxos：少数服从多数，
- CAP: Consistency, Availability, Partition-Tolerance。 CA放弃分区容忍性，这是传统单机数据库的选择。AP放弃一致性. CP放弃可用性。
- BASE: Basically Available基本可用允许分区失败，Soft state软状态，接受一段时间状态不同步，Eventually consistent最终一致性。

## 消息中间件

异步，解耦，消峰



